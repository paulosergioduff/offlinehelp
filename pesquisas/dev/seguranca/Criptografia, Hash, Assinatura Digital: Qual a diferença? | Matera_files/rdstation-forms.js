/**
  * Resultados Digitais - 12/4/2017, 1:39:36 PM
  * rdstation-forms - Client Forms generation script with Forms html.
  * @version v0.0.1
  * @link https://github.com/ResultadosDigitais/rdstation-forms/
  * @license ISC
  */
var CityInputFieldHandler={hostName:"https://cidades.rdstation.com.br",init:function(t,e){var n=this;this.uf_field=e,t.select2({ajax:{url:n.hostName+"/api/cidades/",dataType:"json",delay:250,data:function(t){return{term:t,state_acronym:n.uf_field.val()}},results:function(t,e){return{results:t.cities}},cache:!0},formatResult:n.formatCity,formatSelection:n.formatCity,initSelection:n.selectedCity})},formatCity:function(t){return value=t.name,CityInputFieldHandler.uf_field.val()||(value+=" - "+t.state),value},selectedCity:function(t,e){var n=jQuery(t).val();""!==n&&jQuery.ajax({type:"GET",url:CityInputFieldHandler.hostName+"/api/cidades/"+n,dataType:"json"}).done(function(t){e(t.city)})}};compareVersion=function(t,e){if(typeof t+typeof e!="stringstring")return!1;var n=t.split("."),o=e.split("."),r=Math.max(n.length,o.length);for(i=0;i<r;i++){if(n[i]&&!o[i]&&parseInt(n[i])>0||parseInt(n[i])>parseInt(o[i]))return 1;if(o[i]&&!n[i]&&parseInt(o[i])>0||parseInt(n[i])<parseInt(o[i]))return-1}return 0};var Nibbler=function(t){var e,n,i,o,r,a,s,d,c,u,l,f,h;e=function(){var e,l,f;for(n=t.pad||"",i=t.dataBits,o=t.codeBits,r=t.keyString,a=t.arrayData,l=Math.max(i,o),f=0,s=[],e=0;e<l;e+=1)s.push(f),f+=f+1;c=f,d=i/u(i,o)},u=function(t,e){for(var n;0!==e;)n=e,e=t%e,t=n;return t},l=function(t,e,i,o){var u,l,f,h,p,m,y,v;for(v=function(t){o?a?y.push(t):y.push(String.fromCharCode(t)):y.push(r.charAt(t))},p=0,m=0,y=[],l=t.length,u=0;u<l;u+=1){if(m+=e,o){if(f=t.charAt(u),h=r.indexOf(f),f===n)break;if(h<0)throw'the character "'+f+'" is not a member of '+r}else if(((h=a?t[u]:t.charCodeAt(u))|c)!==c)throw h+" is outside the range 0-"+c;for(p=p<<e|h;m>=i;)m-=i,v(p>>m),p&=s[m]}if(!o&&m>0)for(v(p<<i-m),l=y.length%d,u=0;u<l;u+=1)y.push(n);return a&&o?y:y.join("")},f=function(t){return l(t,i,o,!1)},h=function(t){return l(t,o,i,!0)},this.encode=f,this.decode=h,e()},PhoneInputFieldHandler={formatPhoneMask:function(t){var e=t.keyCode?t.keyCode:t.which,n=(t.target.selectionStart,this.value),i=n.length;PhoneInputFieldHandler.ableToAddMask(e,i)&&(n=n.replace(/\D/g,""),n=n.replace(/^(\d{1})/g,"($1"),n=n.replace(/^([(]\d{2})/g,"$1) "),n=n.replace(/(\d+)(\d{4})$/,"$1-$2"),this.value=n)},ableToAddMask:function(t,e){return!(PhoneInputFieldHandler.isArrow(t)||PhoneInputFieldHandler.isBackspace(t)&&e<14)},isArrow:function(t){return 37==t||39==t},isBackspace:function(t){return 8==t}};RDStationAutofill=function(){function t(t){return["token_rdstation","identificador","c_utmz","traffic_source","captcha","redirect_to","list_id","provider"].indexOf(t[0])>=0||""===t[1]}function e(t){this.$formElement=t}var n=new Nibbler({dataBits:8,codeBits:5,keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",pad:"="});return e.prototype.init=function(){var t=RDStationFormsActions.prototype.readCookie("_form_fields");t=null===t?"":n.decode(t),this.loadConversion(t)},e.prototype.loadConversion=function(e){if(null!==e){var n=e.split("&");jQuery.each(n,function(e,n){var i=n.split("=");if(!t(i)){var o=decodeURIComponent(i[1]).replace(/\+/g," "),r=decodeURIComponent(i[0]),a=this.$formElement.find(':input[name="'+r+'"]');a.is(":checkbox")||"radio"===a.attr("type")?this.$formElement.find(':input[name="'+r+'"][value="'+o+'"]').attr("checked",!0):a.val(o)}}.bind(this))}},e.prototype.saveConversion=function(){var e=this.$formElement.serialize().split("&"),i=jQuery.map(e,function(e){if(!t(e.split("=")))return e}).join("&");RDStationFormsActions.prototype.createCookie("_form_fields",n.encode(i),180)},e}();var RDStationFormsActions=function(){"use strict";function t(t,e){this.formId=t,this.trackCode=e}return t.prototype.setEvents=function(){this.$ajaxLoader=jQuery("#ajax-loader-"+this.formId),this.$form=jQuery("form#conversion-form-"+this.formId),this.$errorMessage=jQuery("form #error-container-"+this.formId),this.$cfSubmit=jQuery("form #cf_submit-"+this.formId),this.formManager=new RDStationFormsManager(this.$form),new RDStationFormsAnalytics(this.formId,this.trackCode).init(),this.isAutofillEnabled()&&(this.autoFill=new RDStationAutofill(this.$form),this.autoFill.init()),compareVersion(jQuery.fn.jquery,"1.7")>=0?this.$form.on("submit",this.handleFormSubmit.bind(this)):this.$form.live("submit",this.handleFormSubmit.bind(this)),this.formManager.setMasksAndFunctions()},t.prototype.handleFormSubmit=function(t){t.preventDefault(),this.$cfSubmit.addClass("hide"),this.$ajaxLoader.removeClass("hide"),this.$errorMessage.addClass("hide"),this.isAutofillEnabled()&&this.autoFill.saveConversion(),this.formManager.validate(this.submitForm.bind(this),this.errorForm.bind(this))},t.prototype.submitForm=function(){var t={dev:"http://localhost:3000/",staging:"https://app-staging.rdstation.com.br/",production:"https://app.rdstation.com.br/"}.production;this.formManager.setValues(),this.sendData(t+"api/1.2/conversions.js",this.$form.serialize())},t.prototype.finishConversion=function(){this.$cfSubmit.removeClass("hide"),this.$ajaxLoader.addClass("hide");var t=this.$form.find("input[name=thankyou_message]").val();t&&alert(t);var e=this.$form.find("input[name='redirect_to']").val();e&&(window.location.href=e)},t.prototype.errorForm=function(){this.$cfSubmit.removeClass("hide"),this.$ajaxLoader.addClass("hide"),this.$errorMessage.removeClass("hide")},t.prototype.sendData=function(t,e){var n=new XMLHttpRequest;n&&(n.open("GET",t+"?"+e,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?this.finishConversion():(this.errorForm(),console.warn("Failed to reach RD Station.")))}.bind(this))},t.prototype.withjQuery=function(t){"undefined"==typeof jQuery?this.loadScript("https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js",t):t()},t.prototype.loadScript=function(t,e){var n=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src=t,i.onload=e,i.onreadystatechange=function(){"complete"===this.readyState&&e()},n.appendChild(i)},t.prototype.readCookie=function(t){var e,n,i=document.cookie.split(";");for(t+="=",e=0;e<i.length;e++){for(n=i[e];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null},t.prototype.createCookie=function(t,e,n){var i="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i="; expires="+o.toGMTString()}document.cookie=t+"="+e+i+"; path=/"},t.prototype.isAutofillEnabled=function(){return this.$form.is("[data-form-autofill]")},t.prototype.init=function(){this.withjQuery(function(){jQuery(document).ready(function(){compareVersion(jQuery.fn.jquery,"1.4")>=0?this.setEvents():console.warn("RD Form incompatible with jQuery "+jQuery.fn.jquery+". Please update to 1.7+")}.bind(this))}.bind(this))},t}(),RDStationFormsAnalytics=function(){"use strict";function t(){return"undefined"!=typeof ga}function e(){return"undefined"!=typeof _gaq&&"undefined"!=typeof _gat}function n(){return"undefined"!=typeof dataLayer}function i(){return"t0"!==ga.getAll()[0].get("name")}function o(){var t=ga.getAll();return r(t,this.trackCode)||t[0]}function r(t,e){try{return a(t,e)}catch(t){return null}}function a(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.get("trackingId")==e)return i}return null}function s(t,e){this.formId=t,this.trackCode=e}return s.prototype.setViewEvent=function(){if(n()&&t()&&i()){var r=o.call(this),a=r.get("name");return void ga(a+".send","event",{eventCategory:"RD Forms",eventAction:"Viewed",eventLabel:this.formId,nonInteraction:!0})}return t()?void ga("send","event","RD Forms","Viewed",this.formId,{nonInteraction:!0}):e()?void _gaq.push(["_trackEvent","RD Forms","Viewed",this.formId,0,!0]):void 0===this.trackCode?void console.warn("No RD Form tracking code"):(console.info("Setting analytics.js code and event"),void this.createGoogleAnalyticsCode())},s.prototype.createGoogleAnalyticsCode=function(){!function(t,e,n,i,o,r,a){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,r=e.createElement(n),a=e.getElementsByTagName(n)[0],r.async=1,r.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(r,a)}(window,document,"script",0,"ga"),ga("create",this.trackCode),ga("send","event","RD Forms","Viewed",this.formId,{nonInteraction:!0})},s.prototype.init=function(){!1===this.trackCode?console.warn("RD Form tracking code disabled"):setTimeout(function(){this.setViewEvent()}.bind(this),5e3)},s}(),RDStationFormsManager=function(){"use strict";function t(t){this.$form=t}return t.prototype.setMasksAndFunctions=function(){this.$form.find(".phone").bind("keyup change",PhoneInputFieldHandler.formatPhoneMask),this.$form.find(".phone").trigger("change"),this.cityInput=this.$form.find("input[name=city_id]"),this.stateInput=this.$form.find("select[name=uf]"),this.withSelect2(function(){CityInputFieldHandler.init(this.cityInput,this.stateInput)}.bind(this))},t.prototype.setValues=function(){this.$form.find("input[name=traffic_source]").val(RDStationFormsActions.prototype.readCookie("__trf.src")),this.$form.find("input[name=c_utmz]").val(RDStationFormsActions.prototype.readCookie("__utmz"));var t="";try{t=JSON.parse(decodeURIComponent(RDStationFormsActions.prototype.readCookie("rdtrk"))).id}catch(t){}this.$form.find("input[name=client_id]").val(t)},t.prototype.validate=function(t,e){this.withValidate(function(){var n=this.$form.validate();this.validateCheckboxes(),this.validatePhones(),n.form()?t():e()}.bind(this))},t.prototype.validateCheckboxes=function(){var t=this.$form;t.find(".field").each(function(){var e=jQuery(this).find(".checkbox:first input:checkbox.required");if(e.length>0){var n=e.attr("name");t.find('[name="'+n+'"]:hidden').remove(),t.find('[name="'+n+'"]').rules("add",{required:!0,minlength:1})}})},t.prototype.validatePhones=function(){this.$form.find("input.phone").each(function(){jQuery(this).rules("add",{minlength:14,maxlength:15})})},t.prototype.withSelect2=function(t){void 0===jQuery.fn.select2?RDStationFormsActions.prototype.loadScript("https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.2/select2.min.js",t):t()},t.prototype.withValidate=function(t){void 0===jQuery.fn.validate?RDStationFormsActions.prototype.loadScript("https://d335luupugsy2.cloudfront.net/js/jquery.validate/1.9/jquery.validate.min.js",t):t()},t}(),RDStationForms=function(){"use strict";function t(t,e){this.formId=this.setId(t),this.trackCode=e,this.tempElement=document.createElement("div"),this.headElement=document.getElementsByTagName("head")[0],this.formElement=document.getElementById(this.formId);var n={dev:"https://forms-dev.rdstation.com.br/",staging:"https://forms-staging.rdstation.com.br/",production:"https://forms.rdstation.com.br/"}.production;this.formUrl=n+t}return t.prototype.renderTemplate=function(){var t=this.tempElement.querySelector("#form-"+this.formId);this.formElement.appendChild(t)},t.prototype.renderStyles=function(){var t=this.tempElement.querySelector("link");this.headElement.appendChild(t);for(var e=this.tempElement.querySelectorAll("style"),n=0;n<e.length;n++)this.headElement.appendChild(e[n])},t.prototype.getTemplateData=function(t,e){var n=new XMLHttpRequest;n&&(n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e(n):console.warn("Failed to get options."))},n.send(null))},t.prototype.generateTemplate=function(t){this.tempElement.innerHTML=t,this.renderTemplate(),this.renderStyles(),this.tempElement=null,new RDStationFormsActions(this.formId,this.trackCode).init()},t.prototype.setId=function(t){return"-html"===t.substr(t.length-5)?t.slice(0,-5):t},t.prototype.createForm=function(){this.getTemplateData(this.formUrl,function(t){this.generateTemplate(t.responseText)}.bind(this))},t}();